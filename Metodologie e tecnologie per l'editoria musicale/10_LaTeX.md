# TeX e LaTeX: Paradigmi e Motivazioni
L'introduzione a **TeX** e **LaTeX** all'interno di un corso di editoria musicale e informatica non è casuale, ma risponde all'esigenza di apprendere un paradigma di scrittura originale basato sulla separazione tra contenuto e stile. A differenza dei comuni word processor (come Microsoft Word), questo sistema si basa sul concetto di **testo strutturato**: l'autore si concentra sul significato logico di ciò che scrive (ad esempio, definendo cosa è un titolo e cosa è un paragrafo), mentre l'aspetto grafico viene gestito automaticamente dal software attraverso dei modelli (template). Questo approccio è lo standard richiesto dagli editori scientifici per la stesura di articoli e, nello specifico del Laboratorio di Informatica Musicale, è la tecnologia richiesta per la stesura della tesi di laurea. Tra i vantaggi principali vi sono la gestione eccellente di formule matematiche complesse, la creazione automatica di indici e bibliografie e, per l'ambito musicale, la possibilità di integrare notazione ed esempi musicali eleganti (ad esempio tramite pacchetti come `gregoriotex`). Di contro, l'approccio non è immediato: il risultato non è visibile in tempo reale e richiede una fase di apprendimento del codice.
### Cenni Storici e Architettura del Sistema
**TeX** (che si pronuncia "Tek", dalla radice greca *téchnē*) è un programma di tipografia digitale creato nel 1978 dal matematico e informatico **Donald Knuth** per ovviare alla scarsa qualità dell'editoria scientifica dell'epoca. È un software libero, noto per la sua stabilità (la numerazione delle versioni converge verso il pigreco). **LaTeX**, invece, è un linguaggio basato su TeX che ne semplifica l'utilizzo attraverso un set di macro predefinite.
Per comprendere il funzionamento del sistema, è utile distinguere i vari livelli che lo compongono: esistono le **distribuzioni** (collezioni di software come MiKTeX o TeX Live), gli **editor/frontend** (le interfacce dove si scrive il codice, come TeXShop o TeXworks), i **motori** (gli eseguibili che compilano il codice, es. pdfTeX) e infine i **formati** e i **pacchetti** (estensioni che aggiungono funzionalità specifiche).
### Il Workflow: WYSIWYM e Strumenti
La filosofia alla base di LaTeX è riassunta dall'acronimo **WYSIWYM** (*What You See Is What You Mean*), in contrapposizione al classico WYSIWYG (*What You See Is What You Get*). In pratica, si scrive un codice sorgente in *plain text* che deve subire un processo di **compilazione** per produrre un file di output (solitamente un PDF). Sebbene sia possibile installare tutto il software necessario in locale (su Windows, macOS o Linux), per il corso si fa riferimento principalmente a **Overleaf**, un editor online che permette di scrivere, gestire progetti e compilare il codice direttamente via browser, facilitando la gestione delle librerie e la collaborazione.
### Struttura di un Documento LaTeX
Un documento LaTeX è strutturato in modo rigido. La prima istruzione è sempre `\documentclass{...}`, che definisce il tipo di documento (ad esempio `article`, `book` o `report`) e ne determina l'impostazione grafica generale. Tutto ciò che precede l'inizio vero e proprio del testo, marcato dal comando `\begin{document}`, è chiamato **preambolo**.
Nel preambolo si impostano i parametri globali (come la dimensione del font o il formato della carta), si caricano i **pacchetti** necessari per estendere le funzioni base (usando il comando `\usepackage{...}`, fondamentale ad esempio per gestire le immagini) e si definiscono i metadati come titolo, autore e data. È importante notare che questi metadati, pur essendo definiti nel preambolo, vengono visualizzati nel documento finale solo se si inserisce il comando `\maketitle` all'interno del corpo del testo (dopo `\begin{document}`).
### Scrittura, Formattazione e Commenti
All'interno del corpo del documento, il testo viene gestito in paragrafi. Una particolarità di LaTeX è che un singolo "a capo" nel codice sorgente viene interpretato come uno spazio semplice; per creare un nuovo paragrafo è necessario lasciare una **riga vuota** nel codice. Esistono comandi per l'interruzione di riga manuale (`\\` o `\newline`), ma il loro uso andrebbe limitato. Per la formattazione del testo, si utilizzano comandi specifici che racchiudono il testo tra parentesi graffe: `\textbf{...}` per il grassetto, `\textit{...}` per il corsivo, `\underline{...}` per il sottolineato e `\texttt{...}` per il carattere *monospaced*. Un comando interessante è `\emph{...}`, che applica l'enfasi in modo contestuale (ad esempio trasformando il tondo in corsivo, o viceversa se si è già in un blocco corsivo). Il codice può essere commentato utilizzando il simbolo percentuale `%`: tutto ciò che segue questo simbolo sulla stessa riga viene ignorato dal compilatore.
### Organizzazione Gerarchica e Riferimenti Incrociati
La potenza di LaTeX emerge nella gestione della struttura. Il documento viene diviso gerarchicamente tramite comandi come `\section{...}`, `\subsection{...}`, `\chapter{...}` (per i libri). Questi elementi vengono numerati automaticamente dal sistema (a meno che non si usi la versione "stellata" del comando, es. `\section*{...}`, che sopprime la numerazione). Grazie a questa marcatura semantica, è possibile generare un indice completo e aggiornato semplicemente inserendo il comando `\tableofcontents` nel punto desiderato.
Infine, LaTeX gestisce in modo eccellente i **riferimenti incrociati**. È possibile assegnare un'etichetta univoca a sezioni, immagini o tabelle tramite il comando `\label{nome_etichetta}`. Per richiamare quel punto nel testo, si usano i comandi `\ref{nome_etichetta}` (per ottenere il numero della sezione/figura) o `\pageref{nome_etichetta}` (per il numero di pagina). È buona norma usare prefissi nelle etichette (come `sec:`, `fig:`, `tab:`) per ricordarne la funzione. Un dettaglio di stile suggerito è l'uso della tilde `~` prima del comando di riferimento (es. `Sez.~\ref{...}`) per inserire uno spazio "non-breaking", che impedisce al numero di finire a capo da solo, separandosi dalla parola che lo precede.
***
## Il Concetto di Ambiente in LaTeX
Dopo aver appreso i comandi base, il passo successivo per strutturare un documento è l'utilizzo degli **ambienti** (*environments*). Se i comandi semplici agiscono su argomenti racchiusi tra graffe, gli ambienti applicano una specifica formattazione o un comportamento logico a un'intera sezione di contenuto delimitata da due tag specifici: `\begin{nome_ambiente}` e `\end{nome_ambiente}`. Tutto ciò che è compreso tra questi due comandi subisce l'effetto dell'ambiente. Un esempio elementare è l'ambiente `center`, che centra orizzontalmente tutto il testo o gli oggetti al suo interno, annullando l'allineamento a sinistra o giustificato predefinito.
### Gestione degli Elenchi
LaTeX gestisce in modo eccellente le liste, che sono un esempio classico di ambiente. Ne esistono principalmente di due tipi:
* **Elenchi puntati (`itemize`):** Creano una lista non ordinata dove ogni voce, introdotta dal comando `\item`, è preceduta da un simbolo (di default un pallino nero, o *bullet*).
* **Elenchi numerati (`enumerate`):** Creano una lista ordinata progressiva (1, 2, 3...). Una funzionalità avanzata utile è la possibilità di modificare il contatore iniziale: inserendo il comando `\addtocounter{enumi}{x}` (dove *x* è un numero intero) subito dopo l'apertura dell'ambiente, è possibile far partire la numerazione da un valore diverso da 1.
Oltre a utilizzare quelli predefiniti, è possibile creare **nuovi ambienti** personalizzati tramite il comando `\newenvironment` inserito nel preambolo. Questo permette di definire una volta sola il codice da eseguire all'apertura e alla chiusura dell'ambiente (ad esempio, formattare una citazione con margini specifici e linee decorative), garantendo coerenza stilistica in tutto il documento.
### Inserimento e Gestione delle Immagini
Per inserire immagini è necessario includere nel preambolo il pacchetto `graphicx`. Il comando base è `\includegraphics{nome_file}`, che supporta vari formati. Un consiglio pratico per l'ambito musicale riguarda l'esportazione da software come **MuseScore**: se possibile, è preferibile esportare le partiture in formato vettoriale (PDF) anziché raster (PNG) per mantenere la massima qualità in fase di stampa.

Le immagini in LaTeX vengono solitamente gestite all'interno dell'ambiente `figure`. Questo ambiente è un "oggetto flottante" (*float*): significa che LaTeX deciderà autonomamente dove posizionare l'immagine per ottimizzare l'impaginazione. Tuttavia, l'utente può suggerire una priorità di posizionamento tramite parametri tra parentesi quadre: `h` (*here*, qui), `t` (*top*, in alto), `b` (*bottom*, in basso) o `p` (*page*, in una pagina dedicata).
All'interno di `figure` si definiscono anche la didascalia (`\caption{...}`) e l'etichetta (`\label{...}`) per i riferimenti incrociati. È fondamentale ricordare che non si deve mai scrivere nel testo "come si vede nella figura sotto", poiché l'immagine potrebbe essere spostata dal compilatore; bisogna invece usare i riferimenti dinamici (`\ref{...}`).
### Inserimento di Codice Sorgente
Per chi deve documentare software o algoritmi, LaTeX offre diversi livelli di gestione del codice, accomunati dall'uso di font monospaziati:
1. **Comando `\texttt{...}`:** Utile per brevissimi frammenti in linea col testo (es. nomi di variabili).
2. **Ambiente `verbatim`:** Mantiene la formattazione esatta del testo (spazi e a capo) ma non evidenzia la sintassi.
3. **Pacchetto `listings`:** È la soluzione professionale. Permette di importare codice da file esterni o scriverlo direttamente nell'ambiente `lstlisting`, supportando la colorazione della sintassi (*syntax highlighting*) per moltissimi linguaggi (Python, C, Java, HTML, ecc.).
### Raffinatezze Tipografiche e Gestione degli Spazi
Per ottenere un documento professionale, è necessario curare i dettagli, spesso gestiti tramite caratteri speciali o pacchetti specifici:
* **Lingua:** Importare il pacchetto `babel` con opzione `italian` (`\usepackage[italian]{babel}`) è essenziale affinché le etichette automatiche appaiano come "Figura" e "Tabella" anziché "Figure" e "Table".
* **Caratteri Speciali:** Alcuni caratteri hanno un significato sintattico in LaTeX (come `&` nelle tabelle o `%` per i commenti). Per stamparli nel testo, devono essere preceduti da un backslash (es. `\&`).
* **Gestione degli Spazi:** LaTeX incrementa leggermente lo spazio dopo un punto fermo. Nelle abbreviazioni (es. "S. Bach"), questo effetto è indesiderato e si corregge inserendo un backslash e uno spazio (`\ `) dopo il punto.
* **Spazio Non-Breaking (`~`):** La tilde è fondamentale nei riferimenti (es. `Fig.~1`). Inserisce uno spazio che impedisce al numero di andare a capo da solo, tenendolo legato alla parola che lo precede.
* **Spazio Sottile (`\,`):** Utile per separare i numeri dalle unità di misura (es. `3\,cm`).
### Errori Comuni da Evitare
Concludendo la panoramica sugli ambienti, è bene fissare alcuni errori tipici del principiante da evitare:
1. **Abuso di `\\`:** Non usare il doppio backslash per andare a capo alla fine di ogni riga. Per cambiare paragrafo serve una riga vuota nel codice; usare `\\` crea un unico paragrafo "spezzato" che rovina l'indentazione e la giustificazione.
2. **Forzatura del Layout:** Non cercare di replicare manualmente l'impaginazione di Word. Bisogna fidarsi dell'algoritmo di LaTeX per il posizionamento di figure e testo.
3. **Riferimenti Vaghi:** Evitare riferimenti spaziali ("sopra", "sotto"); usare sempre il sistema `\label` e `\ref`.
---
# Ambienti Matematici e Simboli Musicali di Base
Prima di addentrarsi nella notazione musicale vera e propria, è utile comprendere come LaTeX gestisce la **modalità matematica**. Questo perché, oltre a essere fondamentale per la stesura di tesi scientifiche (ad esempio sui segnali audio), l'ambiente matematico permette di inserire rapidamente simboli musicali elementari come le alterazioni, senza dover ricorrere a pacchetti esterni.
Esistono due modi per inserire formule o simboli matematici:
1. **In linea col testo:** Si racchiude il contenuto tra simboli del dollaro (`$ ... $`) o tra parentesi tonde precedute da backslash (`\( ... \)`). È ideale per inserire un simbolo all'interno di una frase senza spezzare il paragrafo.
2. **In blocco separato:** Per dare risalto a una formula, si usano i doppi dollari (`$$ ... $$`), le parentesi quadre con backslash (`\[ ... \]`) o l'ambiente `displaymath`. Esiste anche l'ambiente `equation`, che in più aggiunge un numero progressivo a lato della formula, utile per i riferimenti.
Sfruttando questi ambienti, è possibile scrivere direttamente i simboli di bemolle (`$\flat$`), diesis (`$\sharp$`) e bequadro (`$\natural$`).
### Inserimento di Glifi Musicali nel Testo
Quando si ha la necessità di inserire simboli musicali più complessi all'interno di un discorso discorsivo (ad esempio in un libro di teoria o storia della musica), si ricorre a pacchetti specifici.
* **Package `wasysym`:** È una soluzione basilare che offre un set limitato di simboli (il font *Waldi Symbol*), includendo note come `\fullnote`, `\halfnote`, `\eighthnote`, ecc.
* **Package `harmony`:** Molto utile per la musicologia e l'analisi armonica. Fornisce un'ampia gamma di simboli per indicare gradi, accordi e intervalli.
* **Package `lilyglyphs`:** Probabilmente la scelta migliore per qualità estetica, poiché utilizza il font *Emmentaler*, lo stesso del software di notazione LilyPond. Tuttavia, ha un vincolo tecnico importante: richiede il pacchetto `fontspec`, il che significa che **non può essere compilato con pdfLaTeX** (il default di Overleaf), ma richiede l'uso dei motori **XeLaTeX** o **LuaLaTeX**. I comandi permettono di inserire chiavi e alterazioni (es. `\clefGInline`, `\flatflat`) e supportano argomenti per scalare o traslare i simboli.
* **Package `musicography`:** Un'ottima alternativa se si vuole rimanere con il compilatore pdfLaTeX. È pensato per gestire facilmente indicazioni metriche personalizzate (`\musMeter{num}{den}`), valori ritmici e soprattutto il **basso numerato** (tramite il comando `\musFig{...}`).
## Scrittura di Partiture con MusiXTeX
Se l'obiettivo non è solo inserire simboli sparsi ma scrivere intere partiture o estratti musicali, lo standard di riferimento in ambito TeX è **MusiXTeX**. Sebbene esistano alternative come `abc` o l'integrazione con `lilypond`, queste spesso presentano problemi di compatibilità con editor online come Overleaf. MusiXTeX, invece, è pienamente supportato.
Si tratta di un sistema puramente tipografico: l'utente descrive via codice l'aspetto grafico della partitura. Per utilizzarlo, si importa il pacchetto `musixtex` e si scrive il codice musicale all'interno dell'ambiente `music`, delimitato dai comandi `\startpiece ... \endpiece` (per brani lunghi) o `\startextract ... \endextract` (per brevi esempi).
### Configurazione della Partitura
Prima di inserire le note, è necessario configurare la struttura del sistema musicale:
1. **Dimensione:** Si può scegliere tra varie grandezze dei pentagrammi, da `\smallmusicsize` a `\Largemusicsize`. Il default è `\normalmusicsize`.
2. **Numero di Strumenti:** Si definisce con `\instrumentnumber{n}`. È cruciale ricordare che in MusiXTeX **gli strumenti si contano dal basso verso l'alto**. Quindi, in un quartetto, il violoncello sarà lo strumento 1 e il violino primo lo strumento 4.
3. **Pentagrammi per Strumento:** Alcuni strumenti, come il pianoforte, richiedono più righi. Il comando `\setstaffs{n}{p}` assegna *p* pentagrammi allo strumento *n*. I pentagrammi di uno stesso strumento condividono la tonalità e sono uniti da una graffa.
### Chiavi, Tonalità e Metriche
La definizione delle proprietà musicali avviene tramite comandi numerici o simbolici:
* **Chiavi (`\setclef`):** Le chiavi sono identificate da numeri da 0 a 9 (0 è la chiave di violino, 6 quella di basso, 5 baritono, ecc.). Si assegna una chiave a ogni pentagramma di uno strumento. Esistono scorciatoie come `\treble` o `\bass` se la stringa è di un solo carattere.
* **Armatura di Chiave:** Per impostare la tonalità generale si usa `\generalsignature{s}`, dove un numero positivo indica i diesis e uno negativo i bemolli. È possibile specificare tonalità diverse per strumento (ma non per pentagramma dello stesso strumento).
* **Indicazione Metrica:** Il metro si imposta con `\generalmeter{m}`. Si possono usare frazioni (`\meterfrac{3}{4}`) o simboli (`\meterC`, `\allabreve`). Una peculiarità di MusiXTeX è che gestisce la **polimetria** (metri diversi simultanei) senza problemi, poiché il suo approccio è grafico e non semantico: sta all'utente assicurarsi che l'allineamento visivo sia corretto.
Infine, per raggruppare visivamente gli strumenti (come nel sistema di accollatura di un coro o di un'orchestra), si utilizzano comandi come `\grouptop` / `\groupbottom` per le parentesi quadre e `\curlybrackets` per le graffe, specificando sempre gli indici degli strumenti di inizio e fine gruppo.
### Logica di spaziatura nella partitura
In MusiXTeX, la scrittura musicale avviene all'interno dell'ambiente `\begin{music} ... \end{music}`. La logica fondamentale su cui si basa il sistema è la distinzione tra **note spazianti** (*spacing notes*) e **note non spazianti** (*non-spacing notes*). Le prime generano uno spostamento orizzontale dopo la stampa del simbolo, mentre le seconde "congelano" il cursore nella stessa posizione, permettendo la sovrapposizione di simboli. Questa distinzione è cruciale: una melodia monodica utilizzerà note spazianti, mentre per costruire un accordo si useranno note non spazianti per tutte le altezze tranne l'ultima, che sarà spaziante per far avanzare la partitura.
Il brano viene delimitato dai comandi `\startpiece` e `\endpiece` (o varianti come `\startextract` per estratti senza stanghette). La notazione vera e propria è racchiusa tra i comandi `\notes` (o macro analoghe) e `\enotes` (abbreviato `\en`).
### Gestione del Tempo e Distanziamento
A differenza dei software di notazione WYSIWYG, in MusiXTeX il distanziamento orizzontale è controllato esplicitamente attraverso macro specifiche che definiscono quanto spazio dedicare a una nota in relazione alla sua durata. Sebbene il comando base sia `\noteskip`, esistono diverse macro suggerite per specifici valori ritmici: ad esempio, `\notes` è usata tipicamente per i sedicesimi, `\Notes` per gli ottavi, `\NOtes` per i quarti e `\NOTEs` per gli interi. Tuttavia, questo legame è puramente convenzionale: l'utente può decidere arbitrariamente di usare una macro di spaziatura diversa per adattare la densità grafica della partitura.
### Rappresentazione delle Altezze (Pitch)
Esistono due metodi principali per indicare l'altezza delle note, ognuno con i propri vantaggi.
Il **primo metodo utilizza le lettere**: le minuscole (dalla `a` alla `z`) coprono le note a partire dal La sotto il Do centrale verso l'acuto, mentre le maiuscole (dalla `A` alla `N`) indicano le ottave basse. Questo sistema è a "pitch assoluto", indipendente dalla chiave utilizzata.
Il **secondo metodo utilizza i numeri interi**: lo `0` indica la linea più bassa del pentagramma, l'`1` lo spazio subito sopra e così via. Questo approccio è relativo alla posizione visiva sul rigo e risulta immune alla trasposizione o ai cambiamenti di chiave, rendendolo utile per passaggi tecnicamente complessi o per mantenere fissa la posizione grafica.
### Durata, Gambi e Accordi
La durata e la direzione dei gambi sono gestite tramite comandi specifici. Le macro come `\wh` (intero), `\hu` (metà), `\qu` (quarto) e `\cu` (ottavo) definiscono il valore ritmico. I suffissi aggiunti al comando determinano la direzione del gambo: `u` per *upper* (su), `l` per *lower* (giù) e `a` per *auto* (automatico). I punti di valore si ottengono aggiungendo `p` o `pp` al comando.
Per la scrittura degli **accordi**, si utilizzano macro che stampano solo la testa della nota senza avanzare (non-spacing), come `\zq` (per teste piene) o `\zh` (per teste vuote). La sequenza di un accordo termina sempre con una macro spaziante (come `\qu`) che genera il gambo della lunghezza corretta per tutte le note precedentemente impilate. In caso di intervalli di seconda, per evitare collisioni visive, è necessario usare macro di traslazione come `\lq` (testa a sinistra) o `\rq` (testa a destra) per disallineare leggermente le teste delle note rispetto al gambo.
### Alterazioni
Le alterazioni possono essere inserite in due modalità. La modalità "tipografica" prevede l'uso di macro esplicite (es. `\fl` per bemolle, `\sh` per diesis) che sono indipendenti dalla nota successiva; questo permette un controllo fine del posizionamento, utile in casi di polimetria o densità grafica elevata. La seconda modalità, più legata alla logica musicale (*collective coding*), prevede l'inserimento di simboli direttamente nel parametro della nota: ad esempio anteponendo `^` (diesis) o `_` (bemolle) alla lettera dell'altezza (es. `\qa{^g}`).
### Le Travature (Beams)
La gestione delle travi è complessa e richiede di dichiarare l'inizio della trave *prima* di scrivere le note. Esistono travi a **pendenza fissa** (comandi che iniziano per `\ib...`) dove l'utente definisce pendenza e altezza, e travi **semi-automatiche** (comandi che iniziano per `\Ib...`) dove il sistema calcola la pendenza basandosi sulle note di inizio e fine. Ogni trave è identificata da un numero ID univoco (utile per gestire travi sovrapposte).
Le note all'interno della trave si scrivono con il comando `\qb{n}{p}`. Per chiudere una trave si usa `\tbu` o `\tbl`. Esistono tuttavia molte "macro scorciatoia" (come `\Dqbu`, `\Tqbu`) che semplificano la scrittura di gruppi comuni di due, tre o quattro note, gestendo automaticamente inizio e fine della travatura.
### Partiture a Pentagrammi Multipli
Quando si lavora su più pentagrammi (o più voci), la logica di compilazione procede verticalmente, "fetta per fetta", partendo sempre dal pentagramma inferiore verso quello superiore. Il passaggio tra un rigo e l'altro è gestito da caratteri separatori: si usa il carattere `|` (pipe) per separare righi dello stesso strumento (o polifonia interna) e il carattere `&` per passare a uno strumento diverso. Gli ambienti di spaziatura (`\notes...\en`) devono essere aperti e chiusi in modo sincronizzato per tutte le voci, garantendo l'allineamento verticale tipografico dei simboli.